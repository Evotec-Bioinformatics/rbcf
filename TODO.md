improve generate doc

improve functional tests
